(()=>{"use strict";var e={352:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=o(r(127)),n=o(r(622)),i=o(r(334)),u=o(r(420));i.default.config();var a=process.env.SERVER||8080,c=s.default();c.use(s.default.static(n.default.join(__dirname,"../public"))),c.listen(a,(function(){console.log("Running UnityRTC-Template-Server on port:",a)})).on("upgrade",(function(e,t,r){u.default.handleUpgrade(e,t,r,(function(t){u.default.emit("connection",t,e)}))}))},420:function(e,t,r){var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=s(r(439)),i=r(436),u=r(570),a=s(r(350)),c={},d=new n.default.Server({noServer:!0});function p(e){var t=JSON.parse(e),r=this;switch(t.type){case"offer":return function(e,t){f(e,(function(){var r=o(o({},t),{id:e.id});c[e.room].send(t.target,r)}))}(r,t);case"login":return function(e,t){var r=t.username,o=t.password;r&&o?i.sendTo(e,{type:"success",success:u.SocketSuccessType.Login,token:"Cake is a Lie"}):i.sendTo(e,{type:"error",error:"login",message:"Wrong credentials",code:-1})}(r,t.credentials);case"answer":return function(e,t){f(e,(function(){var r=o(o({},t),{id:e.id});c[e.room].send(t.target,r)}))}(r,t);case"candidate":return function(e,t){f(e,(function(){var r=o(o({},t),{id:e.id});c[e.room].send(t.target,r)}))}(r,t);case"leave":return function(e){f(e,(function(){c[e.room].leave(e)}))}(r);case"join":return l(r,t);case"create":return function(e,t){c[t.room]&&i.sendTo(e,{type:"error",error:"room",message:"This room already exists",code:1}),c[t.room]=new a.default(t.room,t.password),l(e,t),i.sendTo(e,{type:"success",success:u.SocketSuccessType.RoomCreate})}(r,t)}}function f(e,t){var r=e.room;c[r]?t():i.sendTo(e,{type:"error",error:"room",message:"Room is not existing",code:4})}function l(e,t){t.token||i.sendTo(e,c[t.room].join(e,t.password)),c[t.room]?i.sendTo(e,c[t.room].join(e,t.password)):i.sendTo(e,{type:"error",error:"room",message:"Room is not existing",code:4})}d.on("connection",(function(e){e.on("message",p.bind(e))})),t.default=d},350:function(e,t,r){var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s=r(436),n=r(570),i=function(){function e(e,t){void 0===t&&(t=""),this.name=e,this.password=t,this.users={},this.count=0,this.host=null}return e.prototype.join=function(e,t){if(t!==this.password)return{type:"error",error:"password",message:"incorrect password",code:2};var r=this.name+"#"+this.count;return e.id=r,e.room=this.name,this.count++,this.host?this.broadcast(e,{type:"join"}):this.host=r,this.users[r]=e,{type:"success",success:n.SocketSuccessType.Join,id:r}},e.prototype.leave=function(e){delete this.users[e.id],this.count--,this.count>0&&(this.broadcast(e,{type:"leave"}),this.host=Object.keys(this.users)[0])},e.prototype.broadcast=function(e,t){var r=o(o({},t),{id:null==e?void 0:e.id});for(var n in this.users)e&&n===e.id||s.sendTo(this.users[n],r)},e.prototype.farwell=function(e){e.id===this.host?this.broadcast(null,{type:"farwell"}):this.send(e.id,{type:"error",message:"You are not host",error:"unothorized",code:-1})},e.prototype.send=function(e,t){return!!this.users[e]&&(s.sendTo(this.users[e],t),!0)},e}();t.default=i},436:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sendTo=void 0,t.sendTo=function(e,t){var r=JSON.stringify(t);e.send(r)}},334:e=>{e.exports=require("dotenv")},127:e=>{e.exports=require("express")},622:e=>{e.exports=require("path")},570:e=>{e.exports=require("unityrtc-types")},439:e=>{e.exports=require("ws")}},t={};!function r(o){if(t[o])return t[o].exports;var s=t[o]={exports:{}};return e[o].call(s.exports,s,s.exports,r),s.exports}(352)})();